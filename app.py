import tensorflow as tf
from flask import Flask,request,render_template
from skimage import io
import cv2
import os
from pymongo import MongoClient
import numpy as np
train=['ABALONE',
 'ACEROLA',
 'ACORN FLOUR',
 'ACORNS',
 'AGAVE',
 'ALFALFA SEEDS',
 'ALMOND BUTTER',
 'ALMONDS',
 'AMARANTH GRAIN',
 'AMARANTH LEAVES',
 'ANCHOVY',
 'APPLE CIDER-FLAVORED DRK',
 'APPLE JUC',
 'APPLESAUCE',
 'APRICOT NECTAR',
 'APRICOTS',
 'ARCHWAY HOME STYLE COOKIES',
 'ARTIFICIAL BLUEBERRY MUFFIN MIX',
 'ARUGULA',
 'AVOCADOS',
 'BACON',
 'BACON BITS',
 'BAGELS',
 'BALSAM-PEAR (BITTER GOURD)',
 'BANANAS',
 'BANQUET CHICK POT PIE',
 'BANQUET ORIG FRIED CHK THIGH',
 'BARBECUE LOAF',
 'BARLEY',
 'BEECHNUTS',
 'BEEF POT PIE',
 'BEEF SAUSAGE',
 'BEEF STEW',
 'BEERWURST',
 'BEET GREENS',
 'BISCUIT',
 'BLACKBERRY JUC',
 'BLUEBERRIES',
 'BLUEFISH',
 'BORAGE',
 'BRATWURST',
 'BRAUNSCHWEIGER (A LIVER SAUSAGE)',
 'BRAZILNUTS',
 'BREAD CRUMBS',
 'BREAD STICKS',
 'BREADFRUIT',
 'BREAKFAST BARS',
 'BREAKFAST BURRITO',
 'BREAKFAST TART',
 'BROADBEANS',
 'BROCCOLI',
 'BROCCOLI RAAB',
 'BROTWURST',
 'BUCKWHEAT GROATS',
 'BURDOCK ROOT',
 'BURRITO',
 'BUTTER-MARGARINE BLEND',
 'BUTTERFISH',
 'BUTTERNUTS',
 'CABBAGE',
 'CAMPBELL SOUPS',
 'CAMPBELL SUPPER BAKES MEAL KITS',
 'CARAMBOLA',
 'CARDOON',
 'CARISSA',
 'CARP',
 'CARROT',
 'CARROT JUICE',
 'CASHEW NUTS',
 'CATSUP',
 'CAULIFLOWER',
 'CAVIAR',
 'CELERIAC',
 'CELERY',
 'CELERY FLAKES',
 'CELTUCE',
 'CEREAL RTE',
 'CEREAL WAFER STRAWS',
 'CHAPATI',
 'CHAYOTE',
 'CHEESE PUFFS&TWISTS',
 'CHEESEFURTER',
 'CHERIMOYA',
 'CHESTNUTS',
 'CHEWING GUM',
 'CHIA SEEDS',
 'CHICKEN NUGGETS',
 'CHICKEN PATTY',
 'CHICKEN POT PIE',
 'CHICKPEAS',
 'CHICORY',
 'CHICORY GREENS',
 'CHICORY ROOTS',
 'CHILI',
 'CHILI WITH BEANS',
 'CHITON',
 'CHIVES',
 'CHOC-FLV BEV MIX FOR MILK',
 'CHOCOLATE-FLAVORED DRK',
 'CHOKECHERRIES',
 'CHORIZO',
 'CHRYSANTHEMUM',
 'CHRYSANTHEMUM LEAVES',
 'CLOUDBERRIES',
 'COCKLES',
 'COCKTAIL MIX',
 'COCOA MIX',
 'COCONUT MEAT',
 'COFFEE SUB',
 'COFFEE&COCOA (MOCHA) PDR',
 'COFFEECAKE',
 'COLESLAW',
 'CONCH',
 'CORIANDER (CILANTRO) LEAVES',
 'CORN',
 'CORN BRAN',
 'CORN CAKES',
 'CORN-BASED',
 'CORNED BEEF LOAF',
 'CORNMEAL',
 'CORNSALAD',
 'COTTONSEED FLR',
 'COTTONSEED MEAL',
 'COUSCOUS',
 'COWPEAS (BLACKEYES)',
 'CRABAPPLES',
 'CRANBERRIES',
 'CRANBERRY JUC',
 'CRANBERRY-ORANGE RELISH',
 'CREAM PUFFS',
 'CREAMY DRSNG',
 'CRESS',
 'CRISPED RICE BAR',
 'CROAKER',
 'CROISSANTS',
 'CROUTONS',
 'CUCUMBER',
 'CURRANTS',
 'CUSTARD-APPLE',
 'Cake',
 'Crackers',
 'DANDELION GREENS',
 'DANDELION GRNS',
 'DANISH PASTRY',
 'DATES',
 'DOSA',
 'DUTCH BRAND LOAF',
 'Doughnuts',
 'ECLAIRS',
 'EDAMAME',
 'EGG CUSTARDS',
 'EGG ROLLS',
 'EGGPLANT',
 'EGGS',
 'ELDERBERRIES',
 'ENDIVE',
 'ENGLISH MUFFIN',
 'EPAZOTE',
 'FALAFEL',
 'FEIJOA',
 'FENNEL',
 'FIDDLEHEAD FERNS',
 'FIREWEED',
 'FISH STICKS',
 'FLAN',
 'FRANKFURTER',
 'FRENCH FRIES',
 'FRENCH TOAST',
 'FROSTING',
 'FRUIT',
 'FRUIT COCKTAIL',
 'FRUIT LEATHER',
 'FRUIT PUNCH DRK',
 'FRUIT SALAD',
 'FRYBREAD',
 'GARLIC',
 'GELATINS',
 'GINGER ROOT',
 'GINKGO NUTS',
 'GRANOLA BAR',
 'GRAPE JUC',
 'GRAPE JUC COCKTAIL',
 'GRAPE LEAVES',
 'GRAPEFRUIT JUICE',
 'GROUPER',
 'GUANABANA NECTAR',
 'GUAVA NECTAR',
 'GUAVA SAUCE',
 'GUAVAS',
 'HALIBUT',
 'HAM',
 'HAZELNUTS OR FILBERTS',
 'HEADCHEESE',
 'HEARTS OF PALM',
 'HICKORYNUTS',
 'HOMINY',
 'HONEY ROLL SAUSAGE',
 'HORMEL CHILI',
 'HORMEL SPAM',
 'HORSERADISH-TREE',
 'HOT POCKETS',
 'HUCKLEBERRIES',
 'HUMMUS',
 'HYACINTH-BEANS',
 'ICE CRM CONES',
 'JACKFRUIT',
 'JAMS & PRESERVES',
 'JAVA-PLUM',
 'JELLIES',
 'JELLYFISH',
 'JERUSALEM-ARTICHOKES',
 "JEW'S EAR",
 'JUJUBE',
 'KACHORI',
 'KALE',
 'KAMUT',
 'KANPYO',
 'KIWI FRUIT',
 'KOHLRABI',
 'KUMQUATS',
 'LAMBS QUARTERS',
 'LASAGNA',
 'LASAGNA MEAT & SAU',
 'LEEKS',
 'LEMON GRASS (CITRONELLA)',
 'LEMON JUICE',
 'LEMON PEEL',
 'LEMONADE',
 'LEMONS',
 'LETTUCE',
 'LIME JUC',
 'LIMEADE',
 'LIMES',
 'LIPTON',
 'LITCHIS',
 'LIVER CHEESE',
 'LONGANS',
 'LOQUATS',
 'LOTUS ROOT',
 'LOTUS SEEDS',
 'LUNCHEON MEAT',
 'LUNCHEON SAUSAGE',
 'MACADAMIA NUTS',
 'MACARONI',
 'MALABAR SPINACH',
 'MAMMY-APPLE',
 'MANCHURIAN',
 'MANGOS',
 'MANGOSTEEN',
 'MARASCHINO CHERRIES',
 'MARMALADE',
 'MAYONNAISE',
 'MEATBALLS',
 'MELON',
 'MELON BALLS',
 'MILLET',
 'MIXED NUTS',
 'MOMOS',
 'MORTADELLA',
 'MOUNTAIN YAM',
 'MUFFIN',
 'MULBERRIES',
 'MUNG BNS',
 'MUSHROOM',
 'MUSSEL',
 'MUSTARD GREENS',
 'MUSTARD SPINACH',
 'Macaroni and Cheese',
 'Mutton',
 'NEW ENGLAND BRAND SAUSAGE',
 'NEW ZEALAND SPINACH',
 'NOODLES',
 'NOPALES',
 'NUTS',
 'OAT BRAN',
 'OAT FLR',
 'OCEAN PERCH',
 'OHELOBERRIES',
 'OKRA',
 'OLIVE LOAF',
 'OLIVES',
 'ONION RINGS',
 'ONIONS',
 'ORANGE-GRAPEFRUIT JUC',
 'ORIENTAL MIX',
 'PARSNIPS',
 'PASSION-FRUIT',
 'PASSION-FRUIT JUC',
 'PASTA MEATBALLS IN TOMATO SAU',
 'PASTRAMI',
 'PATE',
 'PEANUT BUTTER',
 'PEANUT FLOUR',
 'PEAS',
 'PEAS&CARROTS',
 'PECANS',
 'PEPPERONI',
 'PEPPERS',
 'PERCH',
 'PERSIMMONS',
 'PICKLE&PIMIENTO LOAF',
 'PICKLES',
 'PICNIC LOAF',
 'PIE CRUST',
 'PIE FILLINGS',
 'PIGEONPEAS',
 'PILINUTS-CANARYTREE',
 'PILLSBURY GRANDS',
 'PIMENTO',
 'PINE NUTS',
 'PINEAPPLE',
 'PINEAPPLE JUC',
 'PINON NUTS',
 'PISTACHIO NUTS',
 'PITANGA',
 'POHA',
 'POKEBERRY SHOOTS',
 'POMEGRANATE JUC',
 'POMEGRANATES',
 'POPCORN',
 'POPOVERS',
 'PORK SAUSAGE',
 'PORK SAUSAGE RICE LINKS',
 'PORK&BF SAUSAGE',
 'POTATO',
 'POTATO CHIPS',
 'PRETZELS',
 'PRICKLY PEARS',
 'PRUNES',
 'PUDDING',
 'PUFF PASTRY',
 'PUMMELO',
 'PUMPKIN PIE MIX',
 'PUMPKIN&SQUASH SEEDS',
 'PURSLANE',
 'QUAKER OATS',
 'QUINCES',
 'RADICCHIO',
 'RADISH SEEDS',
 'RADISHES',
 'RAISINS',
 'RAMBUTAN',
 'RICE',
 'RICE BRAN',
 'RICE CAKE',
 'RICE FLOUR',
 'RICE NOODLES',
 'ROSE HIPS',
 'ROSE-APPLES',
 'ROSELLE',
 'ROUGHY',
 'SABLEFISH',
 'SAFFLOWER SD MEAL',
 'SALAMI',
 'SALMONBERRIES',
 'SALSIFY',
 'SAMOSA',
 'SANDWICHES&BURGERS',
 'SAPODILLA',
 'SAPOTES',
 'SAUERKRAUT',
 'SAUSAGE',
 'SCALLOP',
 'SCRAPPLE',
 'SCUP',
 'SEA CUCUMBER',
 'SEATROUT',
 'SEMOLINA',
 'SESAME BUTTER',
 'SESAME FLOUR',
 'SESBANIA FLOWER',
 'SHAKE',
 'SHALLOTS',
 'SHERBET',
 'SMELT',
 'SNAPPER',
 'SOURDOCK',
 'SOURSOP',
 'SOY FLR',
 'SOY MEAL',
 'SOYBEAN',
 'SPELT',
 'STEW',
 'STRAWBERRIES',
 'STRUDEL',
 'SUNFLOWER SD FLR',
 'SWAMP CABBAGE',
 'SWEET POTATO LEAVES',
 'SWEET ROLLS',
 'SWEETPOTATO',
 'TACO SHELLS',
 'TAMARINDS',
 'TANGERINE JUC',
 'TAPIOCA',
 'TARO LEAVES',
 'TARO SHOOTS',
 'TEA',
 'TEMPEH',
 'THURINGER',
 'TOMATO SAU',
 'TOMATOES',
 'TORTILLAS',
 'TREE FERN',
 'TURKEY BACON',
 'TURKEY HAM',
 'TURKEY POT PIE',
 'TURKEY ROLL',
 'TURNIP GREENS',
 'TURNIP GRNS&TURNIPS',
 'USDA CMDTY PEACHES',
 'USDA CMDTY PEARS',
 'VERMICELLI',
 'VINESPINACH',
 'WAFFLE',
 'WALNUTS',
 'WASABI',
 'WATERCRESS',
 'WATERMELON',
 'WATERMELON SD KRNLS',
 'WHEAT',
 'WHEAT FLOUR',
 'WHIPPED TOPPING',
 'WILD RICE',
 'WINE',
 'WINGED BEAN',
 'YACHTWURST',
 'YAM',
 'YAMBEAN (JICAMA)',
 'YARDLONG BEAN']
client = MongoClient("mongodb+srv://kuwar:JvKRvzRUKWVrCbSH@cluster0.kgwnehm.mongodb.net/database1")

dbname= client['database1']
collection=dbname['food']


app = Flask(__name__)

def preprocess(url):
    img = io.imread(url)
    img=cv2.cvtColor(img,cv2.COLOR_BGR2RGB)
    img=cv2.resize(img,(128,128),interpolation=cv2.INTER_AREA)
    img=tf.expand_dims(img,axis=0)
    res=model(img)
    return res

def model(img):
    model=tf.keras.models.load_model('model/mod.h5')
    c=model.predict(img)
    name=train[c.argmax()]
    
    return name
@app.route("/", methods=['GET', 'POST'])                 #initialising
def home():                                              #function call

    return render_template('index.html') 
     
@app.route("/predict/<path:url>")
def predict(url):
    result = preprocess(url)
    doc=collection.find_one({'Category':str(result)})
    del(doc['_id'])
     
    return doc
                
                
    
		
            

        
        


if __name__ == '__main__':
    app.run(debug=True)






    